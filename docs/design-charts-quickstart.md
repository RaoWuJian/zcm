# 美工图表功能 - 快速启动指南

## 🚀 快速开始

### 1. 后端测试

测试美工需求模块是否正常工作：

```bash
cd backend
node test-design-request.js
```

**预期输出**：
```
✅ 数据库连接成功
✅ 找到测试用户: xxx
✅ 找到测试部门: xxx
✅ 创建美工需求成功: xxx
✅ 查询到 X 个美工需求
✅ 更新美工需求成功
✅ 完成时间自动记录成功: xxx
✅ 图片数量验证成功: 最多只能上传9张图片
✅ 测试数据清理完成
🎉 所有测试通过！
```

### 2. 启动服务

#### 启动后端
```bash
cd backend
npm start
```

**预期输出**：
```
服务器运行在端口 3000
MongoDB 连接成功
```

#### 启动前端
```bash
cd frontend
npm run dev
```

**预期输出**：
```
VITE v5.x.x  ready in xxx ms

➜  Local:   http://localhost:5173/
➜  Network: use --host to expose
```

### 3. 访问功能

1. 打开浏览器访问：`http://localhost:5173`
2. 登录系统
3. 在左侧菜单找到"美工图表"
4. 点击"需求列表"

## 📝 功能测试清单

### 测试1：创建美工需求

1. 点击"新增需求"按钮
2. 填写需求描述（必填）
3. 上传图片（可选，最多9张）
4. 填写备注（可选）
5. 点击"确定"

**验证点**：
- ✅ 需求创建成功
- ✅ 列表中显示新需求
- ✅ 状态为"待处理"
- ✅ 部门自动关联当前用户部门

### 测试2：编辑美工需求

1. 在列表中找到需求
2. 点击"编辑"按钮
3. 修改需求信息：
   - 分配美工（选择用户）
   - 设置预计完成时间
   - 上传贴图文件
   - 修改状态为"进行中"
4. 点击"确定"

**验证点**：
- ✅ 需求更新成功
- ✅ 分配美工显示正确
- ✅ 预计完成时间显示正确
- ✅ 状态变更为"进行中"

### 测试3：上传图片

1. 编辑需求
2. 点击"选择图片"
3. 选择多张图片（测试最多9张限制）
4. 点击"确定"

**验证点**：
- ✅ 图片上传成功
- ✅ 图片数量显示正确
- ✅ 超过9张时提示错误

### 测试4：查看详情

1. 点击"查看"按钮
2. 查看需求详细信息
3. 点击图片预览
4. 点击文件下载链接

**验证点**：
- ✅ 详情信息完整
- ✅ 图片可以预览
- ✅ 文件可以下载

### 测试5：完成需求

1. 编辑需求
2. 修改状态为"已完成"
3. 点击"确定"
4. 查看详情

**验证点**：
- ✅ 状态变更为"已完成"
- ✅ 已完成时间自动记录
- ✅ 已完成时间显示正确

### 测试6：删除需求

1. 点击"删除"按钮
2. 确认删除

**验证点**：
- ✅ 需求删除成功
- ✅ 列表中不再显示

### 测试7：批量删除

1. 勾选多个需求
2. 点击"批量删除"按钮
3. 确认删除

**验证点**：
- ✅ 批量删除成功
- ✅ 列表中不再显示被删除的需求

### 测试8：搜索和筛选

1. 使用状态筛选（待处理/进行中/已完成）
2. 使用关键字搜索
3. 点击"搜索"按钮
4. 点击"重置"按钮

**验证点**：
- ✅ 状态筛选正确
- ✅ 关键字搜索正确
- ✅ 重置功能正常

### 测试9：权限控制

**测试场景1：普通用户**
1. 使用普通用户登录
2. 创建需求
3. 尝试编辑自己的需求
4. 尝试编辑其他用户的需求

**验证点**：
- ✅ 可以创建需求
- ✅ 可以编辑自己的需求
- ✅ 不能编辑其他用户的需求（如果不是管理员）

**测试场景2：管理员**
1. 使用管理员登录
2. 查看所有需求
3. 编辑任意需求
4. 删除任意需求

**验证点**：
- ✅ 可以查看所有需求
- ✅ 可以编辑任意需求
- ✅ 可以删除任意需求

### 测试10：分页功能

1. 创建多个需求（超过10个）
2. 测试分页切换
3. 测试每页数量切换

**验证点**：
- ✅ 分页显示正确
- ✅ 分页切换正常
- ✅ 每页数量切换正常

## 🐛 常见问题

### 问题1：无法创建需求，提示"您还未分配部门"

**原因**：当前用户没有分配部门

**解决**：
1. 进入"用户管理" -> "员工管理"
2. 编辑用户
3. 分配部门
4. 保存

### 问题2：图片无法显示

**原因**：文件服务未正确配置或文件不存在

**解决**：
1. 检查后端服务是否正常运行
2. 检查文件上传是否成功
3. 检查浏览器控制台是否有错误

### 问题3：文件上传失败

**原因**：文件大小超过限制或格式不支持

**解决**：
1. 图片：确保单个文件不超过5MB
2. 附件：确保单个文件不超过10MB
3. 检查文件格式是否支持

### 问题4：无法查看其他部门的需求

**原因**：权限限制，普通用户只能查看自己部门的需求

**解决**：
- 这是正常的权限控制
- 如需查看所有需求，请使用管理员账号

## 📊 性能测试

### 测试数据量

建议测试以下数据量：
- 10 个需求
- 50 个需求
- 100 个需求
- 500 个需求

### 测试指标

- 列表加载时间
- 图片上传时间
- 搜索响应时间
- 分页切换时间

## 🔍 调试技巧

### 后端调试

查看后端日志：
```bash
# 在 backend 目录下
tail -f logs/app.log  # 如果有日志文件
```

### 前端调试

1. 打开浏览器开发者工具（F12）
2. 查看 Console 标签页的错误信息
3. 查看 Network 标签页的网络请求
4. 检查 API 请求和响应

### 数据库调试

使用 MongoDB Compass 或命令行：
```bash
# 连接数据库
mongo mongodb://localhost:27017/zcm_db

# 查看美工需求集合
db.designrequests.find().pretty()

# 查看需求数量
db.designrequests.count()

# 查看特定状态的需求
db.designrequests.find({ status: 'pending' }).pretty()
```

## ✅ 验收标准

所有测试通过后，确认以下功能正常：

- [x] 创建美工需求
- [x] 编辑美工需求
- [x] 删除美工需求
- [x] 批量删除
- [x] 上传图片（最多9张）
- [x] 上传文件
- [x] 预览图片
- [x] 下载文件
- [x] 分配美工
- [x] 设置预计完成时间
- [x] 状态管理（待处理/进行中/已完成）
- [x] 自动记录完成时间
- [x] 搜索和筛选
- [x] 分页功能
- [x] 权限控制

## 📞 技术支持

如遇到问题，请查看：
- `docs/design-charts-feature.md` - 完整功能文档
- `program.md` - 修改记录和Bug修复
- `must.md` - 开发规范

或运行测试脚本：
```bash
cd backend
node test-design-request.js
```

