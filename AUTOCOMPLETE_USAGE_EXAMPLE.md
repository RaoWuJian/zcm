# Autocomplete 自动完成功能使用示例

## 功能概述

在产品佣金管理的新增/编辑表单中，店铺名称和平台字段现在支持自动完成功能，可以从历史记录中智能提示已有的选项。

## 使用场景示例

### 场景1：新用户首次使用
当用户首次使用系统时，由于没有历史记录，Autocomplete 组件会显示为空的输入框，用户可以正常输入新的店铺名称和平台。

### 场景2：有历史记录的用户
假设系统中已有以下历史记录：

**店铺名称历史记录：**
- 苹果官方旗舰店
- 华为官方旗舰店
- 小米官方旗舰店
- 三星官方旗舰店

**平台历史记录：**
- 天猫
- 京东
- 淘宝
- 拼多多

### 使用体验

#### 1. 店铺名称输入
```
用户输入: "苹"
自动提示: 
- 苹果官方旗舰店

用户输入: "官方"
自动提示:
- 苹果官方旗舰店
- 华为官方旗舰店
- 小米官方旗舰店
- 三星官方旗舰店

用户输入: ""（空输入）
自动提示:
- 华为官方旗舰店
- 苹果官方旗舰店
- 三星官方旗舰店
- 小米官方旗舰店
```

#### 2. 平台输入
```
用户输入: "天"
自动提示:
- 天猫

用户输入: "京"
自动提示:
- 京东

用户输入: ""（空输入）
自动提示:
- 京东
- 拼多多
- 淘宝
- 天猫
```

## 技术实现细节

### 前端组件配置
```vue
<el-autocomplete
  v-model="accountingForm.shopName"
  :fetch-suggestions="queryShopNameSuggestions"
  placeholder="请输入店铺名称（可选）"
  maxlength="100"
  show-word-limit
  clearable
  style="width: 100%"
  @select="handleShopNameSelect"
/>
```

### 数据获取流程
1. 组件挂载时调用 `loadSuggestions()` 方法
2. 方法调用 store 中的 `fetchShopNameSuggestions()` 和 `fetchPlatformSuggestions()`
3. Store 调用 API 接口获取建议数据
4. 后端查询数据库，返回去重排序后的结果
5. 前端缓存建议数据，用于实时过滤

### 过滤逻辑
```javascript
const queryShopNameSuggestions = (queryString, callback) => {
  const results = queryString
    ? shopNameSuggestions.value.filter(item => 
        item.value.toLowerCase().includes(queryString.toLowerCase())
      )
    : shopNameSuggestions.value
  callback(results)
}
```

## 用户操作指南

### 1. 输入建议选项
- 在店铺名称或平台字段中开始输入
- 系统会自动显示匹配的历史记录
- 使用鼠标点击或键盘方向键选择

### 2. 选择建议项
- 鼠标点击：直接点击想要的选项
- 键盘操作：使用上下箭头键选择，回车确认
- 自动填充：选择后会自动填充到输入框

### 3. 清空输入
- 点击输入框右侧的清空按钮
- 或者手动删除所有文本

### 4. 输入新选项
- 如果历史记录中没有想要的选项
- 可以直接输入新的店铺名称或平台
- 保存后会自动加入到建议列表中

## 数据更新机制

### 实时更新
- 每次成功创建或更新记录后
- 系统会自动重新加载建议数据
- 确保新输入的数据立即可用于后续输入

### 权限控制
- 用户只能看到自己有权限访问的记录中的数据
- 管理员可以看到所有用户的历史记录
- 普通用户只能看到同部门及子部门的记录

## 性能优化

### 本地缓存
- 建议数据在前端本地缓存
- 避免每次输入都请求服务器
- 只在必要时（如新增记录后）刷新缓存

### 数据库优化
- 使用 MongoDB 的 `distinct` 方法高效去重
- 在查询中过滤空值，减少无效数据
- 按字母顺序排序，提供更好的用户体验

## 故障排除

### 常见问题
1. **建议列表为空**：可能是首次使用或没有历史记录
2. **建议不准确**：检查输入的关键词是否正确
3. **选择后没有填充**：确保点击了正确的选项

### 解决方案
1. 输入新的店铺名称或平台，保存后会加入建议列表
2. 尝试输入更短的关键词或使用模糊匹配
3. 使用键盘方向键和回车键进行选择
